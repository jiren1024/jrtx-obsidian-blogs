---
{"dg-publish":true,"dg-path":"文章/2022-12-02 动态库的显式调用.md","permalink":"/文章/2022-12-02 动态库的显式调用/","dgEnableSearch":"true"}
---

#Technomous 

与静态库类似，编译时将指定动态库路径一起参与编译属于隐式调用，动态库还可以显式调用。

## 在 Linux 下显式调用动态库

\#include<dlfch.h>，提供了下面几个接口：

``` c
void * dlopen(const char* pathname, int mode)
```

dlopen 函数以指定模式打开指定的动态链接库，并返回一个句柄给调用进程。

``` c
void * dlsym(void* handle, const char* symbol)
```

dlsym 根 据动态链接库操作句柄（pHandle）与符号（symbol），返回符号对应地址。使用这个函数不但可以获取函数地址，也可以获取变量地址。

``` c
int dlclose(void *handle)
```

dlclose 用于关闭指定句柄的动态链接库，只有当此动态链接库的使用计数为0时，才会真正被系统卸载。
 
``` c
const char *dlerror(void) 
```

当动态链接库操作函数失败时，dlerror 可以返回出错信息，返回值为 NULL 时表示操作函数执行成功。

## 在 Windows 下显式调用动态库

应用程序必须进行函数调用以在运行时显式加载 DLL。为显式链接到 DLL，应用程序必须：

调用 LoadLibrary (或相似的函数)以加载 DLL 和获取模块的句柄。

调用 GetProcAddress，以获取指向应用程序要调用的每个导出函数的指针。由于应用程序是通过指针调用 DLL 的函数，编译器不生成外部引用，故无需与导入库链接。

使用完 DLL 后调用 FreeLibrary。