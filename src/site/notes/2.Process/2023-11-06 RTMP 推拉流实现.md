---
{"dg-publish":true,"dg-path":"文章/2023-11-06 RTMP 推拉流实现.md","permalink":"/文章/2023-11-06 RTMP 推拉流实现/"}
---

#Technomous 

![400](/img/user/0.Asset/resource/20231103154516.png)
# 环境搭建

- mediamtx：下载 rtsp 服务器 [mediamtx](https://github.com/bluenviron/mediamtx) 
- ffmpeg：通过  `sudo apt install ffmpeg` 命令直接安装，ffmpeg 包含三个组件，ffmpeg、ffplay 和 ffprobe 。

# 推流拉流
首先启动 rtsp 服务器 mediamtx，然后使用 ffmpeg 向 mediamtx 进行推流，使用 ffmpeg 的组件 ffplay 从 mediamtx 拉流播放视屏。

- mediamtx 启动
``` shell
./mediamtx
```

- ffmpeg 推流
``` shell
ffmpeg -re -stream_loop -1 -i juren.mp4 -c copy -f rtsp rtsp://localhost:8554/stream
```
`-re` ：这个选项告诉 ffmpeg 以视屏的原生帧率播放，这对于流式传输视屏文件非常重要。
`-stream_loop -1`：此选项用于是 ffmpeg 将输入文件无限循环播放（-1 次），以便保持连续播放。
`-i juren.mp4`：这是输入文件标志，指定要流式传输的视屏文件，这里是 "juren.mp4"。
`-c copy`：此选项告诉 ffmpeg 复制视屏和音频流，而不进行重新编码。这对于保留输入文件的原始质量和格式非常有用。
`-f rtsp`：此选项指定输出格式为 RTSP （实时流式传输协议），这是常用于互联网传输音频和视屏的协议
`rtsp://localhost:8554/stream`：这是输出 URL，RTSP 流将在此 URL 上提供。在这种情况下，流将在 "rtsp://localhost:8554/stream" 上可用。

- ffplay 拉流
``` shell
ffplay -rtsp_transport tcp -i rtsp://localhost:8554/stream
```
`-rtsp_transport tcp`：这个选项制定了 RTSP 流的传输方式，使用 TCP。RTSP 支持多种传输方式，包括 UDP 和 TCP。使用 TCP 可以更可靠的处理数据传输，但可能会增加一些延迟。
`-i rtsp://locaohost:8554/stream`：这是 RTSP 流的 URL，其中 `rtsp://locaohost:8554/stream` 是流的位置。
